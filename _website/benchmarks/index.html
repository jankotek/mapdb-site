<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>In-memory benchmarks &mdash; MapDB</title>
    
    <link rel="stylesheet" href="../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="MapDB" href="../" />
    <link rel="next" title="Frequently Asked Questions" href="../faq/" />
    <link rel="prev" title="Changelog" href="../changelog/" />
  
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

<!-- google analytics-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42074659-1', 'auto');
  ga('send', 'pageview');

</script>

  
  <link rel="alternate" type="application/atom+xml"  href="../blog/atom.xml" title="MapDB Blog">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
<div class="pageheader">
  <ul>
    <li><a href="../">Home</a></li>
    <li><a href="../doc/getting-started/">Intro</a></li>
    <li><a href="../doc/">Docs</a></li>
    <li><a href="../blog/">Blog</a></li>
    <li><a href="https://github.com/jankotek/mapdb">Github</a></li>
  </ul>
  <div>
    <a href="../">
      <img src="../_static/logo.png" alt="MapDB" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../faq/" title="Frequently Asked Questions"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../changelog/" title="Changelog"
             accesskey="P">previous</a> |</li>
        <li><a href="../">Home</a>&nbsp;|</li>
 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">In-memory benchmarks</a><ul>
<li><a class="reference internal" href="#maps">Maps</a><ul>
<li><a class="reference internal" href="#memory-usage">Memory usage</a></li>
<li><a class="reference internal" href="#random-updates">Random updates</a></li>
<li><a class="reference internal" href="#random-get">Random get</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../changelog/"
                        title="previous chapter">Changelog</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../faq/"
                        title="next chapter">Frequently Asked Questions</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/benchmarks.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="in-memory-benchmarks">
<h1>In-memory benchmarks<a class="headerlink" href="#in-memory-benchmarks" title="Permalink to this headline">¶</a></h1>
<p>This benchmark compares different Map implementations. We try to keep this test fair, no trick or extra tuning.
Also dataset is small with no GC overhead.</p>
<p>Benchmark source is in <a class="reference external" href="https://github.com/jankotek/mapdb-benchmarks">Github repo</a>.
Please send Pull Request if you have improvements.
All tests ran on Linux with 64bit JDK8.</p>
<div class="section" id="maps">
<h2>Maps<a class="headerlink" href="#maps" title="Permalink to this headline">¶</a></h2>
<p>There are six maps in this test. All tests work on Map with 10 million entries to minimize GC overhead,
Key is 8-byte long, value is 16-byte UUID.
Small objects were chosen to better illustrate overhead of internal Map structures (nodes, hash table..)</p>
<p>HTreeMap is concurrent HashMap implementation from MapDB. It is optimized for bigger keys and large number of entries.
It has some extra features such as entry expiration with TTL or maximal size.</p>
<p>BTreeMap is concurrent TreeMap implementation from MapDB. It is optimized for minimal space usage and for small keys.
It has features to redoce memory and space usage.</p>
<dl class="docutils">
<dt>MapDB serializes all data into in-memory binary store backed by <code class="docutils literal"><span class="pre">byte[]</span></code>. This storage is not limited by GC</dt>
<dd>and <code class="docutils literal"><span class="pre">DirectByteBuffer</span></code> version was tested on half-terabyte of memory.</dd>
</dl>
<p>There is also <code class="docutils literal"><span class="pre">_heap</span></code> mode where MapDB  stores all data on-heap using pointers and object instances.
There is no serialization involved.
This mode is usually faster for smaller sets, but is limited by Garbage Collection.</p>
<div class="section" id="memory-usage">
<h3>Memory usage<a class="headerlink" href="#memory-usage" title="Permalink to this headline">¶</a></h3>
<p>This chart shows how much entries <code class="docutils literal"><span class="pre">Map&lt;Long,UUID&gt;</span></code> can fit into 5GB of heap memory.
JVM starts with 5GB maximal heap size (<code class="docutils literal"><span class="pre">-Xmx5G</span></code>), entries are added  until JVM terminates with <code class="docutils literal"><span class="pre">OutOfMemoryException</span></code>.</p>
<p class="centered">
<strong><strong>Number of entries inserted into Map with 5GB heap, before JVM runs out of memory (higher is better)</strong></strong></p><img alt="../_images/maps_memory_usage.png" src="../_images/maps_memory_usage.png" />
<p>ConcurrentHashMap and ConcurrentSkipListMap are bundled with Java. Their both consume about the same amount of memory.</p>
<p>BTreeMap should have in theory very good space usage. However underlying store is too fragmented after frequent updates,
this bug should be solved soon. <code class="docutils literal"><span class="pre">BTreeMap_pump</span></code> shows best case for BTreeMap, with no fragmentation.</p>
<p><code class="docutils literal"><span class="pre">BTreeMap_heap</span></code> is on-heap version of BTreeMap. It uses specialized node representation
(<code class="docutils literal"><span class="pre">Long[]</span></code> and <code class="docutils literal"><span class="pre">UUID[]</span></code> are internally stored in <code class="docutils literal"><span class="pre">long[]</span></code>) and that makes it space efficient.</p>
<p>HTreeMap is not yet optimized for space usage, no surprise here.</p>
<p>SortedTableMap is very space efficient after compaction.</p>
</div>
<div class="section" id="random-updates">
<h3>Random updates<a class="headerlink" href="#random-updates" title="Permalink to this headline">¶</a></h3>
<p class="centered">
<strong><strong>Time to update 100M random keys on Map with 100M entries (smaller is better)</strong></strong></p><img alt="../_images/maps_update.png" src="../_images/maps_update.png" />
<p><code class="docutils literal"><span class="pre">ConcurrentHashMap</span></code> in this case rocks .</p>
<p><code class="docutils literal"><span class="pre">HTreeMap</span></code> and <code class="docutils literal"><span class="pre">BTreeMap</span></code> are relatively slow. Optimizations are planned for M4.</p>
</div>
<div class="section" id="random-get">
<h3>Random get<a class="headerlink" href="#random-get" title="Permalink to this headline">¶</a></h3>
<p class="centered">
<strong><strong>Time to get 100M random keys on Map with 100M entries (smaller is better)</strong></strong></p><img alt="../_images/maps_get.png" src="../_images/maps_get.png" />
<p><code class="docutils literal"><span class="pre">ConcurrentHashMap</span></code> rocks again.</p>
<p><code class="docutils literal"><span class="pre">BTreeMap_heap</span></code> takes advantage of specialization (it uses <code class="docutils literal"><span class="pre">long[]</span></code> instead of <code class="docutils literal"><span class="pre">Long[]</span></code> in BTree Nodes).</p>
<p><code class="docutils literal"><span class="pre">HTreeMap</span></code> and <code class="docutils literal"><span class="pre">BTreeMap</span></code> are relatively slow. Optimizations are planned for M4.</p>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../faq/" title="Frequently Asked Questions"
             >next</a></li>
        <li class="right" >
          <a href="../changelog/" title="Changelog"
             >previous</a> |</li>
        <li><a href="../">Home</a>&nbsp;|</li>
 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, jan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>